---
project_name: enos-provider
before:
  hooks:
    - 'apk add upx'

builds:
  - main: ./command/enos-flight-control
    id: enos-flight-control
    mod_timestamp: '{{ .CommitTimestamp }}'
    targets:
      - linux_amd64
      - darwin_amd64
      - linux_arm64
    flags:
      - -trimpath
      - -tags=osusergo,netgo
      - -gcflags="all=-N -l"
      - -buildvcs=false
    ldflags:
      - -X main.GitCommit={{ .Commit }}
      - -extldflags=-static
      - -s
      - -w
    env:
      - CGO_ENABLED=0
    hooks:
      post:
        - 'mkdir -p ./internal/flightcontrol/binaries'
        - 'cp {{ .Path }} ./internal/flightcontrol/binaries/{{ .Name }}'
        - 'upx -q -9 ./internal/flightcontrol/binaries/{{ .Name }}'
    binary: 'enos-flight-control_{{ .Os }}_{{ .Arch }}'

  - main: ./command/plugin
    id: terraform-provider-enos
    mod_timestamp: '{{ .CommitTimestamp }}'
    targets:
      - linux_amd64
      - darwin_amd64
      - linux_arm64
      - darwin_arm64
    flags:
      - -trimpath
      - -tags=osusergo,netgo
      - -gcflags="all=-N -l"
      - -buildvcs=false
    ldflags:
      - -X main.GitCommit={{ .Commit }}
      - -extldflags=-static
    env:
      - CGO_ENABLED=0
    binary: 'terraform-provider-enos_{{ .Env.VERSION }}'

changelog:
  skip: true
